@model List<Mini_Project.Models.AdminEventsViewModel>
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<style>
    .btnnn {
        width: 6.5em;
        height: 2.3em;
        margin: 0.5em;
        background: black;
        color: white;
        border: none;
        border-radius: 0.625em;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        position: relative;
        z-index: 1;
        overflow: hidden;
    }

    btnnn :hover {
        color: black;
    }

    btnnn :after {
        content: "";
        background: white;
        position: absolute;
        z-index: -1;
        left: -20%;
        right: -20%;
        top: 0;
        bottom: 0;
        transform: skewX(-45deg) scale(0, 1);
        transition: all 0.5s;
    }

    btnnn :hover:after {
        transform: skewX(-45deg) scale(1, 1);
        -webkit-transition: all 0.5s;
        transition: all 0.5s;
    }

    .carousel-item img {
        object-fit: cover;
        width: 100%;
        height: 650px; 
    }

</style>

<!-- Header-->
<header class="bg-dark py-5" style="border-radius:20px">
    <div class="container px-5" style="border-radius:20px">
        <div class="row gx-5 justify-content-center">
            <div class="col-lg-6">
                <div class="text-center my-5">
                    <h1 class="display-5 fw-bolder text-white mb-2">One City, Many Cultures</h1>
                    <p class="lead text-white-50 mb-4">
                        425 artists, volunteers, and suppliers, attracting an enthusiastic audience of over
                        1100 attendees.
                    </p>
                    <div class="d-grid gap-3 d-sm-flex justify-content-sm-center">
                        <a class="btn btn-outline-light btn-lg px-4" asp-controller="Visitor" asp-action="ViewEvents">View Events</a>
                        <a class="btn btn-outline-light btn-lg px-4" href="#viewPackages">View all Packages</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="venue-weather-container">
    <!-- Google Map -->
    <iframe width="600" height="450" style="border:0" loading="lazy" allowfullscreen
            src="https://www.google.com/maps/embed/v1/place?q=Cape%20Town&key=AIzaSyAHBtfUvui9Re6Hzlxc6j7Fx-UnjPyy3IE"></iframe>

    <!-- Weather Widget -->
    <div class="weather-card">
        <h3>🌤️ Cape Town Weather</h3>
        <div id="weather-info">
            <p>Loading weather...</p>
        </div>
    </div>

</div>

<!-- Events section -->
<section class="py-5 border-bottom" id="popularEvents">
    <div class="container px-5 my-5">
        <div class="row gx-5" id="eventContainer">
            <div class="container mt-4">
                <h2 class="text-center mb-4">Event Details</h2>

                <div class="row">
                    @foreach (var eventItem in Model)
                    {
                        <div class="col-md-6 mb-4">
                            <div class="card shadow-lg border-0 rounded-4">
                                <div class="card-body">
                                    <h4 class="card-title text-primary">@eventItem.Name</h4>
                                    <p><strong>Location:</strong> @eventItem.Location</p>
                                    <p><strong>Start Time:</strong> @eventItem.StartTime.ToString("f")</p>
                                    <p><strong>End Time:</strong> @eventItem.EndTime.ToString("f")</p>
                                    <p><strong>Attendee Limit:</strong> @eventItem.AttendeeLimit</p>

                                    <hr>

                                    <!-- RSVP Section -->
                                    <h5 class="text-success">RSVPs (@eventItem.TotalRSVPs)</h5>

                                    <!-- Comments Section -->
                                    <h5 class="text-info">Comments</h5>
                                    <ul class="list-group mb-3">
                                        @foreach (var comment in eventItem.Comments)
                                        {
                                            <li class="list-group-item">@comment.Content</li>
                                        }
                                    </ul>

                                    <!-- Ratings Section -->
                                    <h5 class="text-warning">Ratings</h5>
                                    @foreach (var rating in eventItem.Ratings)
                                    {
                                        <p>
                                            <strong>Event Rating:</strong> @rating.EventRating/5 |
                                            <strong>Recommendation:</strong> @rating.RecommendationRating/5
                                        </p>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Package Pricing section-->
<section class="bg-light py-5 border-bottom" id="viewPackages">
    <div class="container px-5 my-5">
        <div class="text-center mb-5">
            <h2 class="fw-bolder">Available Packages</h2>
            <p class="lead mb-0">Add to your account when you RSVP for an event</p>
        </div>
        <div class="row gx-5 justify-content-center">
            <!-- Basic -->
            <div class="col-lg-6 col-xl-4">
                <div class="card mb-5 mb-xl-0">
                    <div class="card-body p-5">
                        <div class="small text-uppercase fw-bold text-muted">Basic Package</div>
                        <div class="mb-3">
                            <span class="display-4 fw-bold">R250</span>
                            <span class="text-muted"></span>
                        </div>
                        <ul class="list-unstyled mb-4">
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                <strong></strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                5x Soft Drinks (Coke, Sprite, etc.)
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                2x Complimentary Cocktails / Mocktails
                            </li>     
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Pricing card -->
            <div class="col-lg-6 col-xl-4">
                <div class="card mb-5 mb-xl-0">
                    <div class="card-body p-5">
                        <div class="small text-uppercase fw-bold">
                            <i class="bi bi-star-fill text-warning"></i>
                            Drinks Package
                        </div>
                        <div class="mb-3">
                            <span class="display-4 fw-bold">R1150</span>
                            <span class="text-muted"></span>
                        </div>
                        <ul class="list-unstyled mb-4">
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                <strong></strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                x10 Soft Drinks (Coke, Sprite, etc.)
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                x5 Complimentary Cocktails / Mocktails
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                x5 Bottled Water
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                Discount on Alcoholic Beverages
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Pricing card -->
            <div class="col-lg-6 col-xl-4">
                <div class="card">
                    <div class="card-body p-5">
                        <div class="small text-uppercase fw-bold text-muted"> Food Package</div>
                        <div class="mb-3">
                            <span class="display-4 fw-bold">R1999</span>
                            <span class="text-muted"></span>
                        </div>
                        <ul class="list-unstyled mb-4">
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                x20 Soft Drinks (Coke, Sprite, etc.)
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                x5 Choice of One Main Meal (Burger, Pizza, Pasta, etc.)
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                x10 Bottled Water
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                Discount on Alcoholic Beverages
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                VIP Dining Area Access
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                1x Snack Pack (Popcorn, Chips, etc.)
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check text-primary"></i>
                                Access to Exclusive Bar Area
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCSXynlYk7r4OS5dD7PmsUgYCzi2urRr5s",
        authDomain: "w-mini-project.firebaseapp.com",
        projectId: "w-mini-project",
        storageBucket: "w-mini-project.firebasestorage.app",
        messagingSenderId: "687935156042",
        appId: "1:687935156042:web:b91329905440ce3f5b5bb3",
        measurementId: "G-B657WCTBT3"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function fetchPopularEvents() {
        const eventContainer = document.getElementById("eventContainer");
        eventContainer.innerHTML = ""; // Clear existing content

        const eventsQuery = query(collection(db, "events"), orderBy("RSVP_limit", "desc"), limit(3));
        const eventsSnapshot = await getDocs(eventsQuery);

        eventsSnapshot.forEach((doc) => {
            const eventData = doc.data();
            const eventItem = document.createElement("div");
            eventItem.classList.add("col-lg-4", "mb-5", "mb-lg-0");
            eventItem.innerHTML = `
                <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">
                    <i class="bi bi-calendar-event"></i>
                </div>
                <h2 class="h4 fw-bolder">${eventData.EventName}</h2>
                <p>${eventData.Description || "No description available."}</p>
            `;
            eventContainer.appendChild(eventItem);
        });
    }

    // Fetch popular events when the page loads
    fetchPopularEvents();

    async function fetchWeather() {
            const apiKey = 'ecf8a040e5d45d1eaed66a0dad268ef3';
            const city = 'Cape Town';
            const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${apiKey}`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (response.ok) {
                    const temp = data.main.temp;
                    const description = data.weather[0].description;
                    const humidity = data.main.humidity;
                    const windSpeed = data.wind.speed;

                    document.getElementById('weather-info').innerHTML = `
                        <p><strong>Temperature:</strong> ${temp}°C</p>
                        <p><strong>Condition:</strong> ${description}</p>
                        <p><strong>Humidity:</strong> ${humidity}%</p>
                        <p><strong>Wind Speed:</strong> ${windSpeed} m/s</p>
                    `;
                } else {
                    document.getElementById('weather-info').innerHTML = `<p>Error fetching weather data</p>`;
                }
            } catch (error) {
                document.getElementById('weather-info').innerHTML = `<p>Could not fetch weather data</p>`;
            }
        }

        // Fetch weather when the page loads
        window.onload = fetchWeather;
</script>

<style>
    /* Container for Map & Weather */
    .venue-weather-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        align-items: flex-start;
        padding: 20px;
    }

    /* Google Maps Container */
    .map-container {
        flex: 1;
        min-width: 300px;
        max-width: 600px;
        height: 400px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    /* Weather Card */
    .weather-card {
        flex: 1;
        min-width: 280px;
        max-width: 400px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        text-align: center;
    }

        .weather-card h3 {
            font-size: 1.5rem;
            color: #007BFF;
            margin-bottom: 10px;
        }

        .weather-card p {
            font-size: 1.1rem;
            color: #555;
            margin: 5px 0;
        }
</style>